#!/usr/bin/env sh

# Get the project root directory
PROJECT_ROOT=$(git rev-parse --show-toplevel)

# Run detect-secrets to prevent committing secrets
echo "üîç Scanning for secrets..."
# Exclude .secrets.baseline from scanning (it contains hashes of known false positives)
FILES_TO_SCAN=$(git diff --cached --name-only --diff-filter=ACM | grep -v '.secrets.baseline')
if [ -n "$FILES_TO_SCAN" ]; then
    if ! detect-secrets-hook --baseline "$PROJECT_ROOT/.secrets.baseline" $FILES_TO_SCAN; then
        echo "‚ùå Secret detected! Commit blocked."
        echo "If this is a false positive, update .secrets.baseline:"
        echo "   detect-secrets scan --baseline .secrets.baseline"
        exit 1
    fi
fi

# Run lint-staged for frontend
cd frontend && npx lint-staged
