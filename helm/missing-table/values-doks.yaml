# DOKS environment configuration
# Secrets come from External Secrets Operator (AWS Secrets Manager)
# Image tags updated by CI workflow

namespace: missing-table

backend:
  replicaCount: 1

  image:
    repository: ghcr.io/silverbeer/missing-table-backend
    tag: "23e460e" # backend-tag
    pullPolicy: IfNotPresent

  env:
    environment: "production"
    logLevel: "info"
    disableSecurity: "false"

frontend:
  replicaCount: 1

  image:
    repository: ghcr.io/silverbeer/missing-table-frontend
    tag: "23e460e" # frontend-tag
    pullPolicy: IfNotPresent

  # Production image uses nginx, not npm - override default command
  command: []

  # Vite + nginx: instant startup, no build at runtime
  livenessProbe:
    initialDelaySeconds: 10
    periodSeconds: 10
  readinessProbe:
    initialDelaySeconds: 5
    periodSeconds: 5

ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
  hosts:
    - missingtable.com
    - www.missingtable.com
  tls:
    - secretName: missing-table-tls  #pragma: allowlist secret
      hosts:
        - missingtable.com
        - www.missingtable.com

# Image pull credentials - secret created by External Secrets Operator
# Keep registry/username so imagePullSecrets reference is added to deployments
imageCredentials:
  registry: ghcr.io
  username: silverbeer
  # password comes from ExternalSecret (missing-table-ghcr)
