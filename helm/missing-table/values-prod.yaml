# DOKS environment configuration
# Secrets come from External Secrets Operator (AWS Secrets Manager)
# Image tags and version info updated by CI workflow

namespace: missing-table

# Version information - updated by CI workflow
version: "1.2.2" # version-tag
buildId: "245" # build-id
commitSha: "4aec7a2e9d9581ec4cce8d56e0b9835ca7a0f3bd" # commit-sha
buildDate: "2026-01-28T15:36:37Z" # build-date

backend:
  replicaCount: 1

  image:
    repository: ghcr.io/silverbeer/missing-table-backend
    tag: "4aec7a2" # backend-tag
    pullPolicy: IfNotPresent

  env:
    environment: "production"
    logLevel: "info"
    disableSecurity: "false"
    extra:
      CACHE_ENABLED: "true"

# Redis for caching (deployed by this Helm chart)
redis:
  enabled: true

frontend:
  replicaCount: 1

  image:
    repository: ghcr.io/silverbeer/missing-table-frontend
    tag: "4aec7a2" # frontend-tag
    pullPolicy: IfNotPresent

  # Production image uses nginx, not npm - override default command
  command: []

  # Vite + nginx: instant startup, no build at runtime
  livenessProbe:
    initialDelaySeconds: 10
    periodSeconds: 10
  readinessProbe:
    initialDelaySeconds: 5
    periodSeconds: 5

ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
  hosts:
    - missingtable.com
    - www.missingtable.com
    - api.missingtable.com
  tls:
    - secretName: missing-table-tls  #pragma: allowlist secret
      hosts:
        - missingtable.com
        - www.missingtable.com
        - api.missingtable.com

# Image pull credentials - secret created by External Secrets Operator
# Keep registry/username so imagePullSecrets reference is added to deployments
imageCredentials:
  registry: ghcr.io
  username: silverbeer
  # password comes from ExternalSecret (missing-table-ghcr)
