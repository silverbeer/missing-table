# Production environment configuration (LKE)
# Secrets come from External Secrets Operator (AWS Secrets Manager)
# Image tags and version info updated by CI workflow

namespace: missing-table

# Version information - updated by CI workflow
version: "1.2.2" # version-tag
buildId: "379" # build-id
commitSha: "e4045ad7521069bac6c1f1ec6a05406f33ab7ca2" # commit-sha
buildDate: "2026-02-23T23:04:54Z" # build-date

backend:
  replicaCount: 1

  image:
    repository: ghcr.io/silverbeer/missing-table-backend
    tag: "e4045ad" # backend-tag
    pullPolicy: IfNotPresent

  env:
    environment: "production"
    logLevel: "info"
    disableSecurity: "false"
    extra:
      CACHE_ENABLED: "true"

# Redis for caching (deployed by this Helm chart)
redis:
  enabled: true

# Celery Worker â€” consumes match data from RabbitMQ (match-scraper namespace)
celeryWorker:
  enabled: true
  replicaCount: 1

  rabbitmq:
    username: "guest"
    password: "guest"  #pragma: allowlist secret
    host: "rabbitmq.match-scraper.svc.cluster.local"
    port: 5672

  redis:
    url: "redis://missing-table-redis:6379/0"

frontend:
  replicaCount: 1

  image:
    repository: ghcr.io/silverbeer/missing-table-frontend
    tag: "e4045ad" # frontend-tag
    pullPolicy: IfNotPresent

  # Production image uses nginx, not npm - override default command
  command: []

  # Vite + nginx: instant startup, no build at runtime
  livenessProbe:
    initialDelaySeconds: 10
    periodSeconds: 10
  readinessProbe:
    initialDelaySeconds: 5
    periodSeconds: 5

ingress:
  enabled: true
  className: nginx
  annotations:
    nginx.ingress.kubernetes.io/force-ssl-redirect: "true"
  hosts:
    - missingtable.com
    - www.missingtable.com
    - api.missingtable.com
  tls:
    - secretName: missing-table-tls  #pragma: allowlist secret
      hosts:
        - missingtable.com
        - www.missingtable.com
        - api.missingtable.com

# Image pull credentials - secret created by External Secrets Operator
# Keep registry/username so imagePullSecrets reference is added to deployments
imageCredentials:
  registry: ghcr.io
  username: silverbeer
  # password comes from ExternalSecret (missing-table-ghcr)
